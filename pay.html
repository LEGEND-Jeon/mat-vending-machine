<!DOCTYPE html>
<html>
<head>
  <center>
    <br>
    <br>
    <br>
<meta charset="UTF-8">
<title>Insert title here</title>
</head>
<body>
 
<h1> 인증이 완료되었습니다. <br>돗자리 요금 5000원 결제를 진행합니다.<br>(5000원은 반납 이후 환불됩니다.)</h1>
 <button
  class="fit-picture"
  alt="Grapefruit slice atop a pile of other slices" id="paymentButton">
  <img src="https://developers.kakao.com/tool/resource/static/img/button/pay/payment_icon_yellow_medium.png">
<form method="post" action="https://kapi.kakao.com/v1/payment/ready">
</form>
 </button>
 </center>

    <script>
        // 클라이언트에서 결제 요청 보내는 함수
        const requestPayment = () => {
            try {
                const apiKey = 'fdbbebcde83394e6c92f404294dcfe30';
                const paymentData = {
                    cid: 'imp43035337',
                    partner_order_id: 'T1',
                    partner_user_id: 'user',
                    item_name: '돗자리 대여',
                    quantity: 1,
                    total_amount: 5000, // 결제 총액
                    tax_free_amount: 0, // 비과세 금액
                    approval_url: 'https://legend-jeon.github.io/mat-vending-machine/Complete_payment.html',
                    cancel_url: 'https://legend-jeon.github.io/mat-vending-machine/fail_payment.html',
                    fail_url: 'https://legend-jeon.github.io/mat-vending-machine/fail_payment.html',
                    pg: 'kakaopay', // kakaopay 결제 수단 사용
                };

                const xhr = new XMLHttpRequest();
                xhr.open('POST', 'https://kapi.kakao.com/v1/payment/ready', true);
                xhr.setRequestHeader('Authorization', `KakaoAK ${apiKey}`);
                xhr.setRequestHeader('Content-Type', 'application/json;charset=utf-8');

                xhr.onreadystatechange = function () {
                    if (xhr.readyState === 4) {
                        if (xhr.status === 200) {
                            const data = JSON.parse(xhr.responseText);
                            console.log(data);

                            if (data.next_redirect_pc_url) {
                                window.location.href = data.next_redirect_pc_url;
                            } else {
                                console.error('결제 요청에 실패했습니다.');
                            }
                        } else {
                            console.error('HTTP 요청 실패: ' + xhr.status);
                        }
                    }
                };

                xhr.send(JSON.stringify(paymentData));
            } catch (error) {
                console.error(error);
            }
        };

        // 버튼 클릭 시 결제 요청 보내기
        document.getElementById('paymentButton').addEventListener('click', requestPayment);
    </script>
</body>
</html>
</body>
</html>
