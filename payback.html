<script type="text/javascript" src="https://code.jquery.com/jquery-1.12.4.min.js"></script>
<script type="text/javascript" src="https://service.iamport.kr/js/iamport.payment-1.1.5.js"></script>

<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>결제 취소</title>
</head>
<body>
    <button id="cancelButton">결제 취소</button>
    <script type="text/javascript" src="https://code.jquery.com/jquery-1.12.4.min.js"></script>
    <script>
        $('#cancelButton').click(function () {
            var IMP = window.IMP; // 생략가능
            IMP.init('imp43035337'); // 가맹점 식별코드를 입력하세요

            // 결제 취소 정보 설정
            var cancelData = {
                imp_uid: 'imp_400288796791', // 결제 고유 번호
                merchant_uid: 'T2', // 상점에서 생성한 고유 주문번호
            };

            IMP.request_pay({
                pg: 'kakaopay.TC0ONETIME', // 사용한 PG사 설정
                "cid": "TC0ONETIME",
		"tid": "T2",
                "amount": 5000,
                "tax_free_amount": 0,
            }, function (rsp) {
                console.log(rsp);
                if (rsp.success) {
                    // 결제 성공 시의 작업 수행

                    // 결제 성공 시 생성된 imp_uid를 사용하여 결제 취소 요청
                    IMP.cancel({
                        imp_uid: cancelData.imp_uid,
                        merchant_uid: cancelData.merchant_uid,
                    }, function (cancelRsp) {
                        console.log(cancelRsp);
                        if (cancelRsp.success) {
                            var msg = '결제가 취소되었습니다.';
                            msg += '취소된 금액 : ' + cancelRsp.amount;
                            alert(msg);
                            // 취소가 성공했을 때 실행할 코드를 추가할 수 있습니다.
                        } else {
                            var msg = '결제 취소에 실패하였습니다.';
                            msg += '에러내용 : ' + cancelRsp.error_msg;
                            alert(msg);
                        }
                    });
                }
            });
        });
    </script>
</body>
</html>

</html>
